<h1>Financeiro</h1>
<div class="dashboard-container">

  <!-- ======================== -->
  <!-- CARDS DE RESUMO (AGORA DINÂMICOS) -->
  <!-- ======================== -->
  <div class="summary-cards">
    <div class="card">
      <span class="card-title">Receita Hoje</span>
      <!-- Usamos o 'pipe' de currency (moeda) do Angular -->
      <span class="card-value">{{ resumo.receitaHoje | currency:'BRL' }}</span>
    </div>
    <div class="card">
      <span class="card-title">Receita Semanal</span>
      <span class="card-value">{{ resumo.receitaSemanal | currency:'BRL' }}</span>
    </div>
    <div class="card">
      <span class="card-title">Receita Mensal</span>
      <span class="card-value">{{ resumo.receitaMensal | currency:'BRL' }}</span>
    </div>
    <div class="card">
      <span class="card-title">Pagamentos pendentes</span>
      <span class="card-value">{{ resumo.pagamentosPendentes }}</span>
    </div>
  </div>

  <!-- ======================== -->
  <!-- GRÁFICOS (AINDA FIXOS) -->
  <!-- ======================== -->
  <div class="charts-section" *ngIf="isBrowser">
    <div class="chart-container card">
      <h3>Evolução da receita</h3>
      <div class="chart-wrapper">
        <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="lineChartType">
        </canvas>
      </div>
    </div>
    <div class="chart-container card">
      <h3>Formas de pagamento</h3>
      <div class="chart-wrapper">
        <canvas baseChart [data]="pieChartData" [options]="pieChartOptions" [type]="pieChartType">
        </canvas>
      </div>
    </div>
  </div>

  <!-- ======================== -->
  <!-- TABELA (AGORA DINÂMICA) -->
  <!-- ======================== -->
  <div class="transactions-container card">
    <h3>Transações</h3>

    <!-- Estado de Carregando -->
    <div *ngIf="isLoading" class="empty-state">Carregando transações...</div>

    <!-- Estado Vazio -->
    <div *ngIf="!isLoading && transacoes.length === 0" class="empty-state">
      Nenhuma transação encontrada.
    </div>

    <!-- Tabela de Dados (só aparece se não estiver carregando e tiver dados) -->
    <table class="transactions-table" *ngIf="!isLoading && transacoes.length > 0">
      <thead>
        <tr>
          <th>Data</th>
          <th>Placa</th>
          <th>Valor</th>
          <th>Status</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody>
        <!-- Usamos *ngFor para varrer os dados do backend -->
        <tr *ngFor="let p of transacoes">
          <!-- Usamos o 'pipe' de data -->
          <td>{{ p.dataPagamento | date:'dd/MM/yyyy' }}</td>
          <td>{{ p.placaVeiculo }}</td>
          <td>{{ p.valor | currency:'BRL' }}</td>
          <td>
            <span class="status" 
                  [class.status-pago]="p.status === 'Pago'"
                  [class.status-pendente]="p.status === 'Pendente'">
              {{ p.status }}
            </span>
          </td>
          <td><i class="fas fa-info-circle"></i></td>
        </tr>
      </tbody>
    </table>
  </div>

</div>